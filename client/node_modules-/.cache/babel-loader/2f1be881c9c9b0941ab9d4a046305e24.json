{"ast":null,"code":"var _jsxFileName = \"/Users/jiawenzhu/developer/MERN-Stack-Build-a-social-media-app/client/src/components/message/CallModal.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Avatar from '../Avatar';\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\nimport { addMessage } from '../../redux/actions/messageAction';\nimport RingRing from '../../audio/ringring.mp3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst CallModal = () => {\n  _s();\n\n  const {\n    call,\n    auth,\n    peer,\n    socket,\n    theme\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const [hours, setHours] = useState(0);\n  const [mins, setMins] = useState(0);\n  const [second, setSecond] = useState(0);\n  const [total, setTotal] = useState(0);\n  const [answer, setAnswer] = useState(false);\n  const youVideo = useRef();\n  const otherVideo = useRef();\n  const [tracks, setTracks] = useState(null);\n  const [newCall, setNewCall] = useState(null); // Set Time\n\n  useEffect(() => {\n    const setTime = () => {\n      setTotal(t => t + 1);\n      setTimeout(setTime, 1000);\n    };\n\n    setTime();\n    return () => setTotal(0);\n  }, []);\n  useEffect(() => {\n    setSecond(total % 60);\n    setMins(parseInt(total / 60));\n    setHours(parseInt(total / 3600));\n  }, [total]); // End Call\n\n  const addCallMessage = useCallback((call, times, disconnect) => {\n    if (call.recipient !== auth.user._id || disconnect) {\n      const msg = {\n        sender: call.sender,\n        recipient: call.recipient,\n        text: '',\n        media: [],\n        call: {\n          video: call.video,\n          times\n        },\n        createdAt: new Date().toISOString()\n      };\n      dispatch(addMessage({\n        msg,\n        auth,\n        socket\n      }));\n    }\n  }, [auth, dispatch, socket]);\n\n  const handleEndCall = () => {\n    tracks && tracks.forEach(track => track.stop());\n    if (newCall) newCall.close();\n    let times = answer ? total : 0;\n    socket.emit('endCall', { ...call,\n      times\n    });\n    addCallMessage(call, times);\n    dispatch({\n      type: GLOBALTYPES.CALL,\n      payload: null\n    });\n  };\n\n  useEffect(() => {\n    if (answer) {\n      setTotal(0);\n    } else {\n      const timer = setTimeout(() => {\n        socket.emit('endCall', { ...call,\n          times: 0\n        });\n        addCallMessage(call, 0);\n        dispatch({\n          type: GLOBALTYPES.CALL,\n          payload: null\n        });\n      }, 15000);\n      return () => clearTimeout(timer);\n    }\n  }, [dispatch, answer, call, socket, addCallMessage]);\n  useEffect(() => {\n    socket.on('endCallToClient', data => {\n      tracks && tracks.forEach(track => track.stop());\n      if (newCall) newCall.close();\n      addCallMessage(data, data.times);\n      dispatch({\n        type: GLOBALTYPES.CALL,\n        payload: null\n      });\n    });\n    return () => socket.off('endCallToClient');\n  }, [socket, dispatch, tracks, addCallMessage, newCall]); // Stream Media\n\n  const openStream = video => {\n    const config = {\n      audio: true,\n      video\n    };\n    return navigator.mediaDevices.getUserMedia(config);\n  };\n\n  const playStream = (tag, stream) => {\n    let video = tag;\n    video.srcObject = stream;\n    video.play();\n  }; // Answer Call\n\n\n  const handleAnswer = () => {\n    openStream(call.video).then(stream => {\n      playStream(youVideo.current, stream);\n      const track = stream.getTracks();\n      setTracks(track);\n      const newCall = peer.call(call.peerId, stream);\n      newCall.on('stream', function (remoteStream) {\n        playStream(otherVideo.current, remoteStream);\n      });\n      setAnswer(true);\n      setNewCall(newCall);\n    });\n  };\n\n  useEffect(() => {\n    peer.on('call', newCall => {\n      openStream(call.video).then(stream => {\n        if (youVideo.current) {\n          playStream(youVideo.current, stream);\n        }\n\n        const track = stream.getTracks();\n        setTracks(track);\n        newCall.answer(stream);\n        newCall.on('stream', function (remoteStream) {\n          if (otherVideo.current) {\n            playStream(otherVideo.current, remoteStream);\n          }\n        });\n        setAnswer(true);\n        setNewCall(newCall);\n      });\n    });\n    return () => peer.removeListener('call');\n  }, [peer, call.video]); // Disconnect\n\n  useEffect(() => {\n    socket.on('callerDisconnect', () => {\n      tracks && tracks.forEach(track => track.stop());\n      if (newCall) newCall.close();\n      let times = answer ? total : 0;\n      addCallMessage(call, times, true);\n      dispatch({\n        type: GLOBALTYPES.CALL,\n        payload: null\n      });\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: `The ${call.username} disconnect`\n        }\n      });\n    });\n    return () => socket.off('callerDisconnect');\n  }, [socket, tracks, dispatch, call, addCallMessage, answer, total, newCall]); // Play - Pause Audio\n\n  const playAudio = newAudio => {\n    newAudio.play();\n  };\n\n  const pauseAudio = newAudio => {\n    newAudio.pause();\n    newAudio.currentTime = 0;\n  };\n\n  useEffect(() => {\n    let newAudio = new Audio(RingRing);\n\n    if (answer) {\n      pauseAudio(newAudio);\n    } else {\n      playAudio(newAudio);\n    }\n\n    return () => pauseAudio(newAudio);\n  }, [answer]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"call_modal\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"call_box\",\n      style: {\n        display: answer && call.video ? 'none' : 'flex'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        style: {\n          padding: '40px 0'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          src: call.avatar,\n          size: \"supper-avatar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n          children: call.username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n          children: call.fullname\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this), answer ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: hours.toString().length < 2 ? '0' + hours : hours\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \":\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: mins.toString().length < 2 ? '0' + mins : mins\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \":\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: second.toString().length < 2 ? '0' + second : second\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 27\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          children: call.video ? /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"calling video...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 35\n          }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"calling audio...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 35\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 27\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 17\n      }, this), !answer && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"timer\",\n        children: [/*#__PURE__*/_jsxDEV(\"small\", {\n          children: mins.toString().length < 2 ? '0' + mins : mins\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n          children: \":\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n          children: second.toString().length < 2 ? '0' + second : second\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"call_menu\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"material-icons text-danger\",\n          onClick: handleEndCall,\n          children: \"call_end\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 21\n        }, this), call.recipient === auth.user._id && !answer && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: call.video ? /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"material-icons text-success\",\n            onClick: handleAnswer,\n            children: \"videocam\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 35\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"material-icons text-success\",\n            onClick: handleAnswer,\n            children: \"call\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 35\n          }, this)\n        }, void 0, false)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"show_video\",\n      style: {\n        opacity: answer && call.video ? '1' : '0',\n        filter: theme ? 'invert(1)' : 'invert(0)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: youVideo,\n        className: \"you_video\",\n        playsInline: true,\n        muted: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: otherVideo,\n        className: \"other_video\",\n        playsInline: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"time_video\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: hours.toString().length < 2 ? '0' + hours : hours\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \":\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: mins.toString().length < 2 ? '0' + mins : mins\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \":\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: second.toString().length < 2 ? '0' + second : second\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"material-icons text-danger end_call\",\n        onClick: handleEndCall,\n        children: \"call_end\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 9\n  }, this);\n};\n\n_s(CallModal, \"iC6pXpvmpWUnvFDPqhtvSJs76M8=\", false, function () {\n  return [useSelector, useDispatch];\n});\n\n_c = CallModal;\nexport default CallModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"CallModal\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useSelector","useDispatch","Avatar","GLOBALTYPES","addMessage","RingRing","CallModal","call","auth","peer","socket","theme","state","dispatch","hours","setHours","mins","setMins","second","setSecond","total","setTotal","answer","setAnswer","youVideo","otherVideo","tracks","setTracks","newCall","setNewCall","setTime","t","setTimeout","parseInt","addCallMessage","times","disconnect","recipient","user","_id","msg","sender","text","media","video","createdAt","Date","toISOString","handleEndCall","forEach","track","stop","close","emit","type","CALL","payload","timer","clearTimeout","on","data","off","openStream","config","audio","navigator","mediaDevices","getUserMedia","playStream","tag","stream","srcObject","play","handleAnswer","then","current","getTracks","peerId","remoteStream","removeListener","ALERT","error","username","playAudio","newAudio","pauseAudio","pause","currentTime","Audio","display","padding","avatar","fullname","toString","length","opacity","filter"],"sources":["/Users/jiawenzhu/developer/MERN-Stack-Build-a-social-media-app/client/src/components/message/CallModal.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport Avatar from '../Avatar'\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes'\nimport { addMessage } from '../../redux/actions/messageAction'\nimport RingRing from '../../audio/ringring.mp3'\n\nconst CallModal = () => {\n    const { call, auth, peer, socket, theme } = useSelector(state => state)\n    const dispatch = useDispatch()\n\n    const [hours, setHours] = useState(0)\n    const [mins, setMins] = useState(0)\n    const [second, setSecond] = useState(0)\n    const [total, setTotal] = useState(0)\n\n    const [answer, setAnswer] = useState(false)\n    const youVideo = useRef()\n    const otherVideo = useRef()\n    const [tracks, setTracks] = useState(null)\n    const [newCall, setNewCall] = useState(null)\n\n    // Set Time\n    useEffect(() => {\n        const setTime = () => {\n            setTotal(t => t + 1)\n            setTimeout(setTime, 1000)\n        }\n        setTime()\n\n        return () => setTotal(0)\n    },[])\n\n    useEffect(() => {\n        setSecond(total%60)\n        setMins(parseInt(total/60))\n        setHours(parseInt(total/3600))\n    },[total])\n\n\n    // End Call\n    const addCallMessage = useCallback((call, times, disconnect) => {\n        if(call.recipient !== auth.user._id || disconnect){\n            const msg = {\n                sender: call.sender,\n                recipient: call.recipient,\n                text: '', \n                media: [],\n                call: {video: call.video, times},\n                createdAt: new Date().toISOString()\n            }\n            dispatch(addMessage({msg, auth, socket}))\n        }\n    },[auth, dispatch, socket])\n\n    const handleEndCall = () => {\n        tracks && tracks.forEach(track => track.stop())\n        if(newCall) newCall.close()\n        let times = answer ? total : 0\n        socket.emit('endCall', {...call, times})\n        \n        addCallMessage(call, times)\n        dispatch({type: GLOBALTYPES.CALL, payload: null })\n    }\n\n    useEffect(() => {\n        if(answer){\n            setTotal(0)\n        }else{\n            const timer = setTimeout(() => {\n                socket.emit('endCall', {...call, times: 0})\n                addCallMessage(call, 0)\n                dispatch({type: GLOBALTYPES.CALL, payload: null })\n            }, 15000)\n    \n            return () => clearTimeout(timer)\n        }\n        \n    },[dispatch, answer, call, socket, addCallMessage])\n\n    useEffect(() => {\n        socket.on('endCallToClient', data => {\n            tracks && tracks.forEach(track => track.stop())\n            if(newCall) newCall.close()\n            addCallMessage(data, data.times)\n            dispatch({ type: GLOBALTYPES.CALL, payload: null })\n        })\n\n        return () => socket.off('endCallToClient')\n    },[socket, dispatch, tracks, addCallMessage, newCall])\n\n\n    // Stream Media\n    const openStream = (video) => {\n        const config = { audio: true, video }\n        return navigator.mediaDevices.getUserMedia(config)\n    }\n\n    const playStream = (tag, stream) => {\n        let video = tag;\n        video.srcObject = stream;\n        video.play()\n    }\n\n    // Answer Call\n    const handleAnswer = () => {\n        openStream(call.video).then(stream => {\n            playStream(youVideo.current, stream)\n            const track = stream.getTracks()\n            setTracks(track)\n            \n            const newCall = peer.call(call.peerId, stream);\n            newCall.on('stream', function(remoteStream) {\n                playStream(otherVideo.current, remoteStream)\n            });\n            setAnswer(true)\n            setNewCall(newCall)\n        })\n    }\n\n    useEffect(() => {\n        peer.on('call', newCall => {\n            openStream(call.video).then(stream => {\n                if(youVideo.current){\n                    playStream(youVideo.current, stream)\n                }\n                const track = stream.getTracks()\n                setTracks(track)\n                \n                newCall.answer(stream)\n                newCall.on('stream', function(remoteStream) {\n                    if(otherVideo.current){\n                        playStream(otherVideo.current, remoteStream)\n                    }\n                });\n                setAnswer(true) \n                setNewCall(newCall)\n            })\n        })\n        return () => peer.removeListener('call')\n    },[peer, call.video])\n\n    // Disconnect\n    useEffect(() => {\n        socket.on('callerDisconnect', () => {\n            tracks && tracks.forEach(track => track.stop())\n            if(newCall) newCall.close()\n            let times = answer ? total : 0\n            addCallMessage(call, times, true)\n\n            dispatch({type: GLOBALTYPES.CALL, payload: null })\n\n            dispatch({\n                type: GLOBALTYPES.ALERT, \n                payload: {error: `The ${call.username} disconnect`} \n            })\n        })\n\n        return () => socket.off('callerDisconnect')\n    },[socket, tracks, dispatch, call, addCallMessage, answer, total, newCall])\n\n    // Play - Pause Audio\n    const playAudio = (newAudio) => {\n        newAudio.play()\n    }\n\n    const pauseAudio = (newAudio) => {\n        newAudio.pause()\n        newAudio.currentTime = 0\n    }\n\n    useEffect(() => {\n        let newAudio = new Audio(RingRing)\n        if(answer){\n            pauseAudio(newAudio)\n        }else{\n            playAudio(newAudio)\n        }\n\n        return () => pauseAudio(newAudio)\n    },[answer])\n\n\n    return (\n        <div className=\"call_modal\">\n            <div className=\"call_box\" style={{\n                display: (answer && call.video) ? 'none' : 'flex'\n            }} >\n\n                <div className=\"text-center\" style={{padding: '40px 0'}} >\n                    <Avatar src={call.avatar} size=\"supper-avatar\" />\n                    <h4>{call.username}</h4>\n                    <h6>{call.fullname}</h6>\n\n                    {\n                        answer \n                        ? <div>\n                            <span>{ hours.toString().length < 2 ? '0' + hours : hours }</span>\n                            <span>:</span>\n                            <span>{ mins.toString().length < 2 ? '0' + mins : mins }</span>\n                            <span>:</span>\n                            <span>{ second.toString().length < 2 ? '0' + second : second }</span>\n                        </div>\n                        : <div>\n                            {\n                                call.video\n                                ? <span>calling video...</span>\n                                : <span>calling audio...</span>\n                            }\n                        </div>\n                    }\n                    \n                </div>\n                \n                {\n                    !answer && \n                    <div className=\"timer\">\n                        <small>{ mins.toString().length < 2 ? '0' + mins : mins }</small>\n                        <small>:</small>\n                        <small>{ second.toString().length < 2 ? '0' + second : second }</small>\n                    </div>\n                }\n                \n\n                <div className=\"call_menu\">\n                    <button className=\"material-icons text-danger\"\n                    onClick={handleEndCall}>\n                        call_end\n                    </button>\n                    \n                    {\n                        (call.recipient === auth.user._id && !answer) &&\n                        <>\n                            {\n                                call.video\n                                ? <button className=\"material-icons text-success\"\n                                onClick={handleAnswer}>\n                                    videocam\n                                </button>\n                                : <button className=\"material-icons text-success\"\n                                onClick={handleAnswer}>\n                                    call\n                                </button>\n                            }\n                        </>\n                    }\n                    \n                </div>\n                \n            </div>\n\n            <div className=\"show_video\" style={{\n                opacity: (answer && call.video) ? '1' : '0',\n                filter: theme ? 'invert(1)' : 'invert(0)'\n            }} >\n\n                <video ref={youVideo} className=\"you_video\" playsInline muted />\n                <video ref={otherVideo} className=\"other_video\" playsInline />\n\n                <div className=\"time_video\">\n                    <span>{ hours.toString().length < 2 ? '0' + hours : hours }</span>\n                    <span>:</span>\n                    <span>{ mins.toString().length < 2 ? '0' + mins : mins }</span>\n                    <span>:</span>\n                    <span>{ second.toString().length < 2 ? '0' + second : second }</span>\n                </div>\n\n                <button className=\"material-icons text-danger end_call\"\n                onClick={handleEndCall}>\n                    call_end\n                </button>\n\n            </div>\n\n        </div>\n    )\n}\n\nexport default CallModal\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}