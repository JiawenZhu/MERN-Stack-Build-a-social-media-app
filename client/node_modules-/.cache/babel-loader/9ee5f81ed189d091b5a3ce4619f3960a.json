{"ast":null,"code":"var _jsxFileName = \"/Users/jiawenzhu/developer/MERN-Stack-Build-a-social-media-app/client/src/components/message/RightSide.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UserCard from '../UserCard';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useParams, useHistory } from 'react-router-dom';\nimport MsgDisplay from './MsgDisplay';\nimport Icons from '../Icons';\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\nimport { imageShow, videoShow } from '../../utils/mediaShow';\nimport { imageUpload } from '../../utils/imageUpload';\nimport { addMessage, getMessages, loadMoreMessages, deleteConversation } from '../../redux/actions/messageAction';\nimport LoadIcon from '../../images/loading.gif';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst RightSide = () => {\n  _s();\n\n  const {\n    auth,\n    message,\n    theme,\n    socket,\n    peer\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const {\n    id\n  } = useParams();\n  const [user, setUser] = useState([]);\n  const [text, setText] = useState('');\n  const [media, setMedia] = useState([]);\n  const [loadMedia, setLoadMedia] = useState(false);\n  const refDisplay = useRef();\n  const pageEnd = useRef();\n  const [data, setData] = useState([]);\n  const [result, setResult] = useState(9);\n  const [page, setPage] = useState(0);\n  const [isLoadMore, setIsLoadMore] = useState(0);\n  const history = useHistory();\n  useEffect(() => {\n    const newData = message.data.find(item => item._id === id);\n\n    if (newData) {\n      setData(newData.messages);\n      setResult(newData.result);\n      setPage(newData.page);\n    }\n  }, [message.data, id]);\n  useEffect(() => {\n    if (id && message.users.length > 0) {\n      setTimeout(() => {\n        refDisplay.current.scrollIntoView({\n          behavior: 'smooth',\n          block: 'end'\n        });\n      }, 50);\n      const newUser = message.users.find(user => user._id === id);\n      if (newUser) setUser(newUser);\n    }\n  }, [message.users, id]);\n\n  const handleChangeMedia = e => {\n    const files = [...e.target.files];\n    let err = \"\";\n    let newMedia = [];\n    files.forEach(file => {\n      if (!file) return err = \"File does not exist.\";\n\n      if (file.size > 1024 * 1024 * 5) {\n        return err = \"The image/video largest is 5mb.\";\n      }\n\n      return newMedia.push(file);\n    });\n    if (err) dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err\n      }\n    });\n    setMedia([...media, ...newMedia]);\n  };\n\n  const handleDeleteMedia = index => {\n    const newArr = [...media];\n    newArr.splice(index, 1);\n    setMedia(newArr);\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!text.trim() && media.length === 0) return;\n    setText('');\n    setMedia([]);\n    setLoadMedia(true);\n    let newArr = [];\n    if (media.length > 0) newArr = await imageUpload(media);\n    const msg = {\n      sender: auth.user._id,\n      recipient: id,\n      text,\n      media: newArr,\n      createdAt: new Date().toISOString()\n    };\n    setLoadMedia(false);\n    await dispatch(addMessage({\n      msg,\n      auth,\n      socket\n    }));\n\n    if (refDisplay.current) {\n      refDisplay.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'end'\n      });\n    }\n  };\n\n  useEffect(() => {\n    const getMessagesData = async () => {\n      if (message.data.every(item => item._id !== id)) {\n        await dispatch(getMessages({\n          auth,\n          id\n        }));\n        setTimeout(() => {\n          refDisplay.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'end'\n          });\n        }, 50);\n      }\n    };\n\n    getMessagesData();\n  }, [id, dispatch, auth, message.data]); // Load More\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting) {\n        setIsLoadMore(p => p + 1);\n      }\n    }, {\n      threshold: 0.1\n    });\n    observer.observe(pageEnd.current);\n  }, [setIsLoadMore]);\n  useEffect(() => {\n    if (isLoadMore > 1) {\n      if (result >= page * 9) {\n        dispatch(loadMoreMessages({\n          auth,\n          id,\n          page: page + 1\n        }));\n        setIsLoadMore(1);\n      }\n    } // eslint-disable-next-line\n\n  }, [isLoadMore]);\n\n  const handleDeleteConversation = () => {\n    if (window.confirm('Do you want to delete?')) {\n      dispatch(deleteConversation({\n        auth,\n        id\n      }));\n      return history.push('/message');\n    }\n  }; // Call\n\n\n  const caller = _ref => {\n    let {\n      video\n    } = _ref;\n    const {\n      _id,\n      avatar,\n      username,\n      fullname\n    } = user;\n    const msg = {\n      sender: auth.user._id,\n      recipient: _id,\n      avatar,\n      username,\n      fullname,\n      video\n    };\n    dispatch({\n      type: GLOBALTYPES.CALL,\n      payload: msg\n    });\n  };\n\n  const callUser = _ref2 => {\n    let {\n      video\n    } = _ref2;\n    const {\n      _id,\n      avatar,\n      username,\n      fullname\n    } = auth.user;\n    const msg = {\n      sender: _id,\n      recipient: user._id,\n      avatar,\n      username,\n      fullname,\n      video\n    };\n    if (peer.open) msg.peerId = peer._id;\n    socket.emit('callUser', msg);\n  };\n\n  const handleAudioCall = () => {\n    caller({\n      video: false\n    });\n    callUser({\n      video: false\n    });\n  };\n\n  const handleVideoCall = () => {\n    caller({\n      video: true\n    });\n    callUser({\n      video: true\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"message_header\",\n      style: {\n        cursor: 'pointer'\n      },\n      children: user.length !== 0 && /*#__PURE__*/_jsxDEV(UserCard, {\n        user: user,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-phone-alt\",\n            onClick: handleAudioCall\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-video mx-3\",\n            onClick: handleVideoCall\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-trash text-danger\",\n            onClick: handleDeleteConversation\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat_container\",\n      style: {\n        height: media.length > 0 ? 'calc(100% - 180px)' : ''\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat_display\",\n        ref: refDisplay,\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            marginTop: '-25px',\n            opacity: 0\n          },\n          ref: pageEnd,\n          children: \"Load more\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 21\n        }, this), data.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [msg.sender !== auth.user._id && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat_row other_message\",\n            children: /*#__PURE__*/_jsxDEV(MsgDisplay, {\n              user: user,\n              msg: msg,\n              theme: theme\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 215,\n              columnNumber: 45\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 41\n          }, this), msg.sender === auth.user._id && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat_row you_message\",\n            children: /*#__PURE__*/_jsxDEV(MsgDisplay, {\n              user: auth.user,\n              msg: msg,\n              theme: theme,\n              data: data\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 45\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 41\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 33\n        }, this)), loadMedia && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat_row you_message\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: LoadIcon,\n            alt: \"loading\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 28\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 24\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"show_media\",\n      style: {\n        display: media.length > 0 ? 'grid' : 'none'\n      },\n      children: media.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"file_media\",\n        children: [item.type.match(/video/i) ? videoShow(URL.createObjectURL(item), theme) : imageShow(URL.createObjectURL(item), theme), /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => handleDeleteMedia(index),\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 29\n        }, this)]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 25\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"chat_input\",\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Enter you message...\",\n        value: text,\n        onChange: e => setText(e.target.value),\n        style: {\n          filter: theme ? 'invert(1)' : 'invert(0)',\n          background: theme ? '#040404' : '',\n          color: theme ? 'white' : ''\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Icons, {\n        setContent: setText,\n        content: text,\n        theme: theme\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"file_upload\",\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fas fa-image text-danger\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          name: \"file\",\n          id: \"file\",\n          multiple: true,\n          accept: \"image/*,video/*\",\n          onChange: handleChangeMedia\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"material-icons\",\n        disabled: text || media.length > 0 ? false : true,\n        children: \"near_me\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n\n_s(RightSide, \"Z0sNB3UdCfamIbOLVz++IuYLd9s=\", false, function () {\n  return [useSelector, useDispatch, useParams, useHistory];\n});\n\n_c = RightSide;\nexport default RightSide;\n\nvar _c;\n\n$RefreshReg$(_c, \"RightSide\");","map":{"version":3,"names":["React","useState","useEffect","useRef","UserCard","useSelector","useDispatch","useParams","useHistory","MsgDisplay","Icons","GLOBALTYPES","imageShow","videoShow","imageUpload","addMessage","getMessages","loadMoreMessages","deleteConversation","LoadIcon","RightSide","auth","message","theme","socket","peer","state","dispatch","id","user","setUser","text","setText","media","setMedia","loadMedia","setLoadMedia","refDisplay","pageEnd","data","setData","result","setResult","page","setPage","isLoadMore","setIsLoadMore","history","newData","find","item","_id","messages","users","length","setTimeout","current","scrollIntoView","behavior","block","newUser","handleChangeMedia","e","files","target","err","newMedia","forEach","file","size","push","type","ALERT","payload","error","handleDeleteMedia","index","newArr","splice","handleSubmit","preventDefault","trim","msg","sender","recipient","createdAt","Date","toISOString","getMessagesData","every","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","handleDeleteConversation","window","confirm","caller","video","avatar","username","fullname","CALL","callUser","open","peerId","emit","handleAudioCall","handleVideoCall","cursor","height","marginTop","opacity","map","display","match","URL","createObjectURL","value","filter","background","color"],"sources":["/Users/jiawenzhu/developer/MERN-Stack-Build-a-social-media-app/client/src/components/message/RightSide.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\nimport UserCard from '../UserCard'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useParams, useHistory } from 'react-router-dom'\nimport MsgDisplay from './MsgDisplay'\nimport Icons from '../Icons'\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes'\nimport { imageShow, videoShow } from '../../utils/mediaShow'\nimport { imageUpload } from '../../utils/imageUpload'\nimport { addMessage, getMessages, loadMoreMessages, deleteConversation } from '../../redux/actions/messageAction'\nimport LoadIcon from '../../images/loading.gif'\n\nconst RightSide = () => {\n    const { auth, message, theme, socket, peer } = useSelector(state => state)\n    const dispatch = useDispatch()\n\n    const { id } = useParams()\n    const [user, setUser] = useState([])\n    const [text, setText] = useState('')\n    const [media, setMedia] = useState([])\n    const [loadMedia, setLoadMedia] = useState(false)\n\n    const refDisplay = useRef()\n    const pageEnd = useRef()\n\n    const [data, setData] = useState([])\n    const [result, setResult] = useState(9)\n    const [page, setPage] = useState(0)\n    const [isLoadMore, setIsLoadMore] = useState(0)\n\n    const history = useHistory()\n\n    useEffect(() => {\n        const newData = message.data.find(item => item._id === id)\n        if(newData){\n            setData(newData.messages)\n            setResult(newData.result)\n            setPage(newData.page)\n        }\n    },[message.data, id])\n\n    useEffect(() => {\n        if(id && message.users.length > 0){\n            setTimeout(() => {\n                refDisplay.current.scrollIntoView({behavior: 'smooth', block: 'end'})\n            },50)\n\n            const newUser = message.users.find(user => user._id === id)\n            if(newUser) setUser(newUser)\n        }\n    }, [message.users, id])\n\n    const handleChangeMedia = (e) => {\n        const files = [...e.target.files]\n        let err = \"\"\n        let newMedia = []\n\n        files.forEach(file => {\n            if(!file) return err = \"File does not exist.\"\n\n            if(file.size > 1024 * 1024 * 5){\n                return err = \"The image/video largest is 5mb.\"\n            }\n\n            return newMedia.push(file)\n        })\n\n        if(err) dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err} })\n        setMedia([...media, ...newMedia])\n    }\n\n    const handleDeleteMedia = (index) => {\n        const newArr = [...media]\n        newArr.splice(index, 1)\n        setMedia(newArr)\n    }\n\n    const handleSubmit = async (e) => {\n        e.preventDefault()\n        if(!text.trim() && media.length === 0) return;\n        setText('')\n        setMedia([])\n        setLoadMedia(true)\n\n        let newArr = [];\n        if(media.length > 0) newArr = await imageUpload(media)\n\n        const msg = {\n            sender: auth.user._id,\n            recipient: id,\n            text, \n            media: newArr,\n            createdAt: new Date().toISOString()\n        }\n\n        setLoadMedia(false)\n        await dispatch(addMessage({msg, auth, socket}))\n        if(refDisplay.current){\n            refDisplay.current.scrollIntoView({behavior: 'smooth', block: 'end'})\n        }\n    }\n\n    useEffect(() => {\n        const getMessagesData = async () => {\n            if(message.data.every(item => item._id !== id)){\n                await dispatch(getMessages({auth, id}))\n                setTimeout(() => {\n                    refDisplay.current.scrollIntoView({behavior: 'smooth', block: 'end'})\n                },50)\n            }\n        }\n        getMessagesData()\n    },[id, dispatch, auth, message.data])\n\n\n    // Load More\n    useEffect(() => {\n        const observer = new IntersectionObserver(entries => {\n            if(entries[0].isIntersecting){\n                setIsLoadMore(p => p + 1)\n            }\n        },{\n            threshold: 0.1\n        })\n\n        observer.observe(pageEnd.current)\n    },[setIsLoadMore])\n\n    useEffect(() => {\n        if(isLoadMore > 1){\n            if(result >= page * 9){\n                dispatch(loadMoreMessages({auth, id, page: page + 1}))\n                setIsLoadMore(1)\n            }\n        }\n        // eslint-disable-next-line\n    },[isLoadMore])\n\n    const handleDeleteConversation = () => {\n        if(window.confirm('Do you want to delete?')){\n            dispatch(deleteConversation({auth, id}))\n            return history.push('/message')\n        }\n    }\n\n    // Call\n    const caller = ({video}) => {\n        const { _id, avatar, username, fullname } = user\n\n        const msg = {\n            sender: auth.user._id,\n            recipient: _id, \n            avatar, username, fullname, video\n        }\n        dispatch({ type: GLOBALTYPES.CALL, payload: msg })\n    }\n\n    const callUser = ({video}) => {\n        const { _id, avatar, username, fullname } = auth.user\n\n        const msg = {\n            sender: _id,\n            recipient: user._id, \n            avatar, username, fullname, video\n        }\n\n        if(peer.open) msg.peerId = peer._id\n\n        socket.emit('callUser', msg)\n    }\n\n    const handleAudioCall = () => {\n        caller({video: false})\n        callUser({video: false})\n    }\n    \n    const handleVideoCall = () => {\n        caller({video: true})\n        callUser({video: true})\n    }\n\n    return (\n        <>\n            <div className=\"message_header\" style={{cursor: 'pointer'}} >\n                {\n                    user.length !== 0 &&\n                    <UserCard user={user}>\n                        <div>\n                            <i className=\"fas fa-phone-alt\"\n                            onClick={handleAudioCall} />\n\n                            <i className=\"fas fa-video mx-3\"\n                            onClick={handleVideoCall} />\n\n                            <i className=\"fas fa-trash text-danger\"\n                            onClick={handleDeleteConversation} />\n                        </div>\n                    </UserCard>\n                }\n            </div>\n\n            <div className=\"chat_container\" \n            style={{height: media.length > 0 ? 'calc(100% - 180px)' : ''}} >\n                <div className=\"chat_display\" ref={refDisplay}>\n                    <button style={{marginTop: '-25px', opacity: 0}} ref={pageEnd}>\n                        Load more\n                    </button>\n\n                    {\n                        data.map((msg, index) => (\n                                <div key={index}>\n                                    {\n                                        msg.sender !== auth.user._id &&\n                                        <div className=\"chat_row other_message\">\n                                            <MsgDisplay user={user} msg={msg} theme={theme} />\n                                        </div>\n                                    }\n\n                                    {\n                                        msg.sender === auth.user._id &&\n                                        <div className=\"chat_row you_message\">\n                                            <MsgDisplay user={auth.user} msg={msg} theme={theme} data={data} />\n                                        </div>\n                                    }\n                                </div>\n                        ))\n                    }\n                    \n\n                   {\n                       loadMedia && \n                       <div className=\"chat_row you_message\">\n                           <img src={LoadIcon} alt=\"loading\"/>\n                       </div>\n                   }\n\n                </div>\n            </div>\n\n            <div className=\"show_media\" style={{display: media.length > 0 ? 'grid' : 'none'}} >\n                {\n                    media.map((item, index) => (\n                        <div key={index} id=\"file_media\">\n                            {\n                                item.type.match(/video/i)\n                                ? videoShow(URL.createObjectURL(item), theme)\n                                : imageShow(URL.createObjectURL(item), theme)\n                            }\n                            <span onClick={() => handleDeleteMedia(index)} >&times;</span>\n                        </div>\n                    ))\n                }\n            </div>\n\n            <form className=\"chat_input\" onSubmit={handleSubmit} >\n                <input type=\"text\" placeholder=\"Enter you message...\"\n                value={text} onChange={e => setText(e.target.value)}\n                style={{\n                    filter: theme ? 'invert(1)' : 'invert(0)',\n                    background: theme ? '#040404' : '',\n                    color: theme ? 'white' : ''\n                }} />\n\n                <Icons setContent={setText} content={text} theme={theme} />\n\n                <div className=\"file_upload\">\n                    <i className=\"fas fa-image text-danger\" />\n                    <input type=\"file\" name=\"file\" id=\"file\"\n                    multiple accept=\"image/*,video/*\" onChange={handleChangeMedia} />\n                </div>\n\n                <button type=\"submit\" className=\"material-icons\" \n                disabled={(text || media.length > 0) ? false : true}>\n                    near_me\n                </button>\n            </form>\n        </>\n    )\n}\n\nexport default RightSide\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}